// @yaireo/tagify@4.33.1 downloaded from https://ga.jspm.io/npm:@yaireo/tagify@4.33.1/dist/tagify.esm.js

var n="&#8203;";function e(n,D){(null==D||D>n.length)&&(D=n.length);for(var A=0,C=new Array(D);A<D;A++)C[A]=n[A];return C}function i(n){return function(n){if(Array.isArray(n))return e(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,D){if(n){if("string"==typeof n)return e(n,D);var A=Object.prototype.toString.call(n).slice(8,-1);"Object"===A&&n.constructor&&(A=n.constructor.name);return"Map"===A||"Set"===A?Array.from(A):"Arguments"===A||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A)?e(n,D):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var D={isEnabled:function(){var n;return null===(n=window.TAGIFY_DEBUG)||void 0===n||n},log:function(){for(var n=arguments.length,D=new Array(n),A=0;A<n;A++)D[A]=arguments[A];var C;this.isEnabled()&&(C=console).log.apply(C,["[Tagify]:"].concat(i(D)))},warn:function(){for(var n=arguments.length,D=new Array(n),A=0;A<n;A++)D[A]=arguments[A];var C;this.isEnabled()&&(C=console).warn.apply(C,["[Tagify]:"].concat(i(D)))}},s=function(n,D,A,C){return n=""+n,D=""+D,C&&(n=n.trim(),D=D.trim()),A?n==D:n.toLowerCase()==D.toLowerCase()},a=function(n,D){return n&&Array.isArray(n)&&n.map((function(n){return o(n,D)}))};function o(n,D){var A,C={};for(A in n)D.indexOf(A)<0&&(C[A]=n[A]);return C}function r(n){return(new DOMParser).parseFromString(n.trim(),"text/html").body.firstElementChild}function l(n,D){for(D=D||"previous";n=n[D+"Sibling"];)if(3==n.nodeType)return n}function d(n){return"string"==typeof n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):n}function c(n){var D=Object.prototype.toString.call(n).split(" ")[1].slice(0,-1);return n===Object(n)&&"Array"!=D&&"Function"!=D&&"RegExp"!=D&&"HTMLUnknownElement"!=D}function u(n,D,A){var C,k;function a(n,D){for(var A in D)if(D.hasOwnProperty(A)){if(c(D[A])){c(n[A])?a(n[A],D[A]):n[A]=Object.assign({},D[A]);continue}if(Array.isArray(D[A])){n[A]=Object.assign([],D[A]);continue}n[A]=D[A]}}return C=n,(null!=(k=Object)&&"undefined"!=typeof Symbol&&k[Symbol.hasInstance]?k[Symbol.hasInstance](C):C instanceof k)||(n={}),a(n,D),A&&a(n,A),n}function g(){var n=[],D={},A=!0,C=!1,k=void 0;try{for(var L,P=arguments[Symbol.iterator]();!(A=(L=P.next()).done);A=!0){var j=L.value,K=!0,Y=!1,Z=void 0;try{for(var tt,et=j[Symbol.iterator]();!(K=(tt=et.next()).done);K=!0){var it=tt.value;c(it)?D[it.value]||(n.push(it),D[it.value]=1):n.includes(it)||n.push(it)}}catch(n){Y=!0,Z=n}finally{try{K||null==et.return||et.return()}finally{if(Y)throw Z}}}}catch(n){C=!0,k=n}finally{try{A||null==P.return||P.return()}finally{if(C)throw k}}return n}function h(n){return String.prototype.normalize?"string"==typeof n?n.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:n}var p=function(){return/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent)};function f(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(n){return(n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16)}))}function m(n){var D;return b.call(this,n)&&(null==n||null===(D=n.classList)||void 0===D?void 0:D.contains(this.settings.classNames.tag))}function v(n){return b.call(this,n)&&(null==n?void 0:n.closest(this.settings.classNames.tagSelector))}function b(n){var D;return(null==n||null===(D=n.closest)||void 0===D?void 0:D.call(n,this.settings.classNames.namespaceSelector))===this.DOM.scope}function w(n,D){var A=window.getSelection();return D=D||A.getRangeAt(0),"string"==typeof n&&(n=document.createTextNode(n)),D&&(D.deleteContents(),D.insertNode(n)),n}function y(n,A,C){return n?(A&&(n.__tagifyTagData=C?A:u({},n.__tagifyTagData||{},A)),n.__tagifyTagData):(D.warn("tag element doesn't exist",{tagElm:n,data:A}),A)}function T(n){if(n&&n.parentNode){var D=n,A=window.getSelection(),C=A.getRangeAt(0);A.rangeCount&&(C.setStartAfter(D),C.collapse(!0),A.removeAllRanges(),A.addRange(C))}}function O(n,D){n.forEach((function(n){if(y(n.previousSibling)||!n.previousSibling){var A=document.createTextNode("​");n.before(A),D&&T(A)}}))}var A={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,addTagOn:["blur","tab","enter"],onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,focusable:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:function(){},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:" "},autoComplete:{enabled:!0,rightKey:!1,tabKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",scopeLoading:"tagify--loading",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty",inputInvalid:"tagify__input--invalid",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownHeader:"tagify__dropdown__header",dropdownFooter:"tagify__dropdown__footer",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownItemHidden:"tagify__dropdown__item--hidden",dropdownItemSelected:"tagify__dropdown__item--selected",dropdownInital:"tagify__dropdown--initial",tag:"tagify__tag",tagText:"tagify__tag-text",tagX:"tagify__tag__removeBtn",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,escapeHTML:!0,highlightFirst:!0,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:function(){return Promise.resolve()},beforePaste:function(){return Promise.resolve()},suggestionClick:function(){return Promise.resolve()},beforeKeyDown:function(){return Promise.resolve()}}};function x(n,D,A){return D in n?Object.defineProperty(n,D,{value:A,enumerable:!0,configurable:!0,writable:!0}):n[D]=A,n}function S(n){for(var D=1;D<arguments.length;D++){var A=null!=arguments[D]?arguments[D]:{},C=Object.keys(A);"function"==typeof Object.getOwnPropertySymbols&&(C=C.concat(Object.getOwnPropertySymbols(A).filter((function(n){return Object.getOwnPropertyDescriptor(A,n).enumerable})))),C.forEach((function(D){x(n,D,A[D])}))}return n}function I(n,D){return D=null!=D?D:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(D)):function(n,D){var A=Object.keys(n);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(n);D&&(C=C.filter((function(D){return Object.getOwnPropertyDescriptor(n,D).enumerable}))),A.push.apply(A,C)}return A}(Object(D)).forEach((function(A){Object.defineProperty(n,A,Object.getOwnPropertyDescriptor(D,A))})),n}function M(n,D){(null==D||D>n.length)&&(D=n.length);for(var A=0,C=new Array(D);A<D;A++)C[A]=n[A];return C}function E(n,D,A){return D in n?Object.defineProperty(n,D,{value:A,enumerable:!0,configurable:!0,writable:!0}):n[D]=A,n}function N(n){return function(n){if(Array.isArray(n))return M(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,D){if(n){if("string"==typeof n)return M(n,D);var A=Object.prototype.toString.call(n).slice(8,-1);"Object"===A&&n.constructor&&(A=n.constructor.name);return"Map"===A||"Set"===A?Array.from(A):"Arguments"===A||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A)?M(n,D):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(){for(var n in this.dropdown={},this._dropdown)this.dropdown[n]="function"==typeof this._dropdown[n]?this._dropdown[n].bind(this):this._dropdown[n];this.dropdown.refs(),this.DOM.dropdown.__tagify=this}var C,k,L=(C=function(n){for(var D=1;D<arguments.length;D++){var A=null!=arguments[D]?arguments[D]:{},C=Object.keys(A);"function"==typeof Object.getOwnPropertySymbols&&(C=C.concat(Object.getOwnPropertySymbols(A).filter((function(n){return Object.getOwnPropertyDescriptor(A,n).enumerable})))),C.forEach((function(D){E(n,D,A[D])}))}return n}({},{events:{binding:function(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],D=this.dropdown.events.callbacks,A=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:D.onKeyDown.bind(this),onMouseOver:D.onMouseOver.bind(this),onMouseLeave:D.onMouseLeave.bind(this),onClick:D.onClick.bind(this),onScroll:D.onScroll.bind(this)},C=n?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(document[C]("scroll",A.position,!0),window[C]("resize",A.position),window[C]("keydown",A.onKeyDown)),this.DOM.dropdown[C]("mouseover",A.onMouseOver),this.DOM.dropdown[C]("mouseleave",A.onMouseLeave),this.DOM.dropdown[C]("mousedown",A.onClick),this.DOM.dropdown.content[C]("scroll",A.onScroll)},callbacks:{onKeyDown:function(n){var A=this;if(this.state.hasFocus&&!this.state.composing){var C=this.settings,k=C.dropdown.includeSelectedTags,L=this.DOM.dropdown.querySelector(C.classNames.dropdownItemActiveSelector),P=this.dropdown.getSuggestionDataByNode(L),j="mix"==C.mode,K="select"==C.mode;C.hooks.beforeKeyDown(n,{tagify:this}).then((function(Y){switch(n.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":n.preventDefault();var Z=A.dropdown.getAllSuggestionsRefs(),tt="ArrowUp"==n.key||"Up"==n.key;L&&(L=A.dropdown.getNextOrPrevOption(L,!tt)),L&&L.matches(C.classNames.dropdownItemSelector)||(L=Z[tt?Z.length-1:0]),A.dropdown.highlightOption(L,!0);break;case"PageUp":case"PageDown":var et;n.preventDefault();var it=A.dropdown.getAllSuggestionsRefs(),nt=Math.floor(A.DOM.dropdown.content.clientHeight/(null===(et=it[0])||void 0===et?void 0:et.offsetHeight))||1,st="PageUp"===n.key;if(L){var at=it.indexOf(L),ot=st?Math.max(0,at-nt):Math.min(it.length-1,at+nt);L=it[ot]}else L=it[0];A.dropdown.highlightOption(L,!0);break;case"Home":case"End":n.preventDefault();var rt=A.dropdown.getAllSuggestionsRefs();L=rt["Home"===n.key?0:rt.length-1],A.dropdown.highlightOption(L,!0);break;case"Escape":case"Esc":A.dropdown.hide();break;case"ArrowRight":if(A.state.actions.ArrowLeft||C.autoComplete.rightKey)return;case"Tab":var lt=!C.autoComplete.rightKey||!C.autoComplete.tabKey;if(!j&&!K&&L&&lt&&!A.state.editing&&P){n.preventDefault();var dt=A.dropdown.getMappedValue(P);return A.state.autoCompleteData=P,A.input.autocomplete.set.call(A,dt),!1}return!0;case"Enter":n.preventDefault(),A.state.actions.selectOption=!0,setTimeout((function(){return A.state.actions.selectOption=!1}),100),C.hooks.suggestionClick(n,{tagify:A,tagData:P,suggestionElm:L}).then((function(){if(L){var D=k?L:A.dropdown.getNextOrPrevOption(L,!tt);A.dropdown.selectOption(L,n,(function(){if(D){var n=D.getAttribute("value");D=A.dropdown.getSuggestionNodeByValue(n),A.dropdown.highlightOption(D)}}))}else A.dropdown.hide(),j||A.addTags(A.state.inputText.trim(),!0)})).catch((function(n){return D.warn(n)}));break;case"Backspace":if(j||A.state.editing.scope)return;var ct=A.input.raw.call(A);""!=ct&&8203!=ct.charCodeAt(0)||(!0===C.backspace?A.removeTags():"edit"==C.backspace&&setTimeout(A.editTag.bind(A),0))}}))}},onMouseOver:function(n){var D=n.target.closest(this.settings.classNames.dropdownItemSelector);this.dropdown.highlightOption(D)},onMouseLeave:function(n){this.dropdown.highlightOption()},onClick:function(n){var A=this;if(0==n.button&&n.target!=this.DOM.dropdown&&n.target!=this.DOM.dropdown.content){var C=n.target.closest(this.settings.classNames.dropdownItemSelector),k=this.dropdown.getSuggestionDataByNode(C);this.state.actions.selectOption=!0,setTimeout((function(){return A.state.actions.selectOption=!1}),100),this.settings.hooks.suggestionClick(n,{tagify:this,tagData:k,suggestionElm:C}).then((function(){C?A.dropdown.selectOption(C,n):A.dropdown.hide()})).catch((function(n){return D.warn(n)}))}},onScroll:function(n){var D=n.target,A=D.scrollTop/(D.scrollHeight-D.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(A)})}}},refilter:function(n){n=n||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems(n),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger("dropdown:updated",this.DOM.dropdown)},getSuggestionDataByNode:function(n){for(var D,A=n&&n.getAttribute("value"),C=this.suggestedListItems.length;C--;){if(c(D=this.suggestedListItems[C])&&D.value==A)return D;if(D==A)return{value:D}}},getSuggestionNodeByValue:function(n){return this.dropdown.getAllSuggestionsRefs().find((function(D){return D.getAttribute("value")===n}))},getNextOrPrevOption:function(n){var D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=this.dropdown.getAllSuggestionsRefs(),C=A.findIndex((function(D){return D===n}));return D?A[C+1]:A[C-1]},highlightOption:function(n,D){var A,C=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(C),this.state.ddItemElm.removeAttribute("aria-selected")),!n)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);A=this.dropdown.getSuggestionDataByNode(n),this.state.ddItemData=A,this.state.ddItemElm=n,n.classList.add(C),n.setAttribute("aria-selected",!0),D&&(n.parentNode.scrollTop=n.clientHeight+n.offsetTop-n.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,A),this.dropdown.position())},selectOption:function(n,D,A){var C=this,k=this.settings,L=k.dropdown.includeSelectedTags,P=k.dropdown,j=P.clearOnSelect,K=P.closeOnSelect;if(!n)return this.addTags(this.state.inputText,!0),void(K&&this.dropdown.hide());D=D||{};var Y=n.getAttribute("value"),Z="noMatch"==Y,tt="mix"==k.mode,et=this.suggestedListItems.find((function(n){var D;return(null!==(D=n.value)&&void 0!==D?D:n)==Y}));if(this.trigger("dropdown:select",{data:et,elm:n,event:D}),et||Z){if(this.state.editing){var it=this.normalizeTags([et])[0];et=k.transformTag.call(this,it)||it,this.onEditTagDone(null,u({__isValid:!0},et))}else this[tt?"addMixTags":"addTags"]([et||this.input.raw.call(this)],j);(tt||this.DOM.input.parentNode)&&(setTimeout((function(){C.DOM.input.focus(),C.toggleFocusClass(!0)})),K&&setTimeout(this.dropdown.hide.bind(this)),L?A&&A():(n.addEventListener("transitionend",(function(){C.dropdown.fillHeaderFooter(),setTimeout((function(){n.remove(),C.dropdown.refilter(),A&&A()}),100)}),{once:!0}),n.classList.add(this.settings.classNames.dropdownItemHidden)))}else K&&setTimeout(this.dropdown.hide.bind(this))},selectAll:function(n){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems("");var D=this.dropdown.filterListItems("");return n||(D=this.state.dropdown.suggestions),this.addTags(D,!0),this},filterListItems:function(n,D){var A,C,k,L,P,j,l=function(){var n,K,Y=void 0,nt=void 0;n=it[rt],C=(null!=(K=Object)&&"undefined"!=typeof Symbol&&K[Symbol.hasInstance]?K[Symbol.hasInstance](n):n instanceof K)?it[rt]:{value:it[rt]};var st,at=Object.keys(C).some((function(n){return ot.includes(n)}))?ot:["value"];Z.fuzzySearch&&!D.exact?(L=at.reduce((function(n,D){return n+" "+(C[D]||"")}),"").toLowerCase().trim(),Z.accentedSearch&&(L=h(L),j=h(j)),Y=0==L.indexOf(j),nt=L===j,st=L,k=j.toLowerCase().split(" ").every((function(n){return st.includes(n.toLowerCase())}))):(Y=!0,k=at.some((function(n){var A=""+(C[n]||"");return Z.accentedSearch&&(A=h(A),j=h(j)),Z.caseSensitive||(A=A.toLowerCase()),nt=A===j,D.exact?A===j:0==A.indexOf(j)}))),P=!Z.includeSelectedTags&&A.isTagDuplicate(c(C)?C.value:C),k&&!P&&(nt&&Y?et.push(C):"startsWith"==Z.sortby&&Y?tt.unshift(C):tt.push(C))},K=this,Y=this.settings,Z=Y.dropdown,tt=(D=D||{},[]),et=[],it=Y.whitelist,nt=Z.maxItems>=0?Z.maxItems:1/0,st=Z.includeSelectedTags,at="function"==typeof Z.sortby,ot=Z.searchKeys,rt=0;if(!(n="select"==Y.mode&&this.value.length&&this.value[0][Y.tagTextProp]==n?"":n)||!ot.length){tt=st?it:it.filter((function(n){return!K.isTagDuplicate(c(n)?n.value:n)}));var lt=at?Z.sortby(tt,j):tt.slice(0,nt);return this.state.dropdown.suggestions=lt,lt}for(j=Z.caseSensitive?""+n:(""+n).toLowerCase();rt<it.length;rt++)A=this,l();this.state.dropdown.suggestions=et.concat(tt);lt=at?Z.sortby(et.concat(tt),j):et.concat(tt).slice(0,nt);return this.state.dropdown.suggestions=lt,lt},getMappedValue:function(n){var D=this.settings.dropdown.mapValueTo;return D?"function"==typeof D?D(n):n[D]||n.value:n.value},createListHTML:function(n){var D=this;return u([],n).map((function(n,A){"string"!=typeof n&&"number"!=typeof n||(n={value:n});var C=D.dropdown.getMappedValue(n);return C="string"==typeof C&&D.settings.dropdown.escapeHTML?d(C):C,D.settings.templates.dropdownItem.apply(D,[I(S({},n),{mappedValue:C}),D])})).join("")}}),k=null!=(k={refs:function(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-wrapper']")},getHeaderRef:function(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-header']")},getFooterRef:function(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-footer']")},getAllSuggestionsRefs:function(){return N(this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector))},show:function(n){var D,A,C,k=this,L=this.settings,P="mix"==L.mode&&!L.enforceWhitelist,j=!L.whitelist||!L.whitelist.length,K="manual"==L.dropdown.position;if(n=void 0===n?this.state.inputText:n,!(j&&!P&&!L.templates.dropdownItemNoMatch||!1===L.dropdown.enabled||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(n),n&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",n),L.templates.dropdownItemNoMatch&&(C=L.templates.dropdownItemNoMatch.call(this,{value:n}))),!C){if(this.suggestedListItems.length)n&&P&&!this.state.editing.scope&&!s(this.suggestedListItems[0].value,n)&&this.suggestedListItems.unshift({value:n});else{if(!n||!P||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:n}]}A=""+(c(D=this.suggestedListItems[0])?D.value:D),L.autoComplete&&A&&0==A.indexOf(n)&&this.input.autocomplete.suggest.call(this,D)}this.dropdown.fill(C),L.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(L.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=n||!0,this.state.dropdown.query=n,this.setStateSelection(),K||setTimeout((function(){k.dropdown.position(),k.dropdown.render()})),setTimeout((function(){k.trigger("dropdown:show",k.DOM.dropdown)}))}},hide:function(n){var D=this,A=this.DOM,C=A.scope,k=A.dropdown,L="manual"==this.settings.dropdown.position&&!n;if(k&&document.body.contains(k)&&!L)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),C.setAttribute("aria-expanded",!1),k.parentNode.removeChild(k),setTimeout((function(){D.state.dropdown.visible=!1}),100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",k),this},toggle:function(n){this.dropdown[this.state.dropdown.visible&&!n?"hide":"show"]()},getAppendTarget:function(){var n=this.settings.dropdown;return"function"==typeof n.appendTarget?n.appendTarget():n.appendTarget},render:function(){var n,D,A,C=this,k=(n=this.DOM.dropdown,(A=n.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(A),D=A.clientHeight,A.parentNode.removeChild(A),D),L=this.settings,P=this.dropdown.getAppendTarget();return!1===L.dropdown.enabled||(this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(L.classNames.dropdownInital),this.dropdown.position(k),P.appendChild(this.DOM.dropdown),setTimeout((function(){return C.DOM.dropdown.classList.remove(L.classNames.dropdownInital)})))),this},fill:function(n){n="string"==typeof n?n:this.dropdown.createListHTML(n||this.suggestedListItems);var D,A=this.settings.templates.dropdownContent.call(this,n);this.DOM.dropdown.content.innerHTML=(D=A)?D.replace(/\>[\r\n ]+\</g,"><").split(/>\s+</).join("><").trim():""},fillHeaderFooter:function(){var n=this.dropdown.filterListItems(this.state.dropdown.query),D=this.parseTemplate("dropdownHeader",[n]),A=this.parseTemplate("dropdownFooter",[n]),C=this.dropdown.getHeaderRef(),k=this.dropdown.getFooterRef();D&&(null==C||C.parentNode.replaceChild(D,C)),A&&(null==k||k.parentNode.replaceChild(A,k))},position:function(n){var D=this.settings.dropdown,A=this.dropdown.getAppendTarget();if("manual"!=D.position&&A){var C,k,L,P,j,K,Y,Z,tt,et,it=this.DOM.dropdown,nt=D.RTL,st=A===document.body,at=A===this.DOM.scope,ot=st?window.pageYOffset:A.scrollTop,rt=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,lt=rt.clientHeight,dt=Math.max(rt.clientWidth||0,window.innerWidth||0),ct=dt>480?D.position:"all",ut=this.DOM["input"==ct?"input":"scope"];if(n=n||it.clientHeight,this.state.dropdown.visible){if("text"==ct?(L=(C=function(){var n=document.getSelection();if(n.rangeCount){var D,A,C=n.getRangeAt(0),k=C.startContainer,L=C.startOffset;if(L>0)return(A=document.createRange()).setStart(k,L-1),A.setEnd(k,L),{left:(D=A.getBoundingClientRect()).right,top:D.top,bottom:D.bottom};if(k.getBoundingClientRect)return k.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,k=C.top,P=C.left,j="auto"):(K=function(n){var D=0,A=0;for(n=n.parentNode;n&&n!=rt;)D+=n.offsetTop||0,A+=n.offsetLeft||0,n=n.parentNode;return{top:D,left:A}}(A),C=ut.getBoundingClientRect(),k=at?-1:C.top-K.top,L=(at?C.height:C.bottom-K.top)-1,P=at?-1:C.left-K.left,j=C.width+"px"),!st){var gt=function(){for(var n=0,A=D.appendTarget.parentNode;A;)n+=A.scrollTop||0,A=A.parentNode;return n}();k+=gt,L+=gt}var ht;k=Math.floor(k),L=Math.ceil(L),Z=dt-P<120,tt=((Y=null!==(ht=D.placeAbove)&&void 0!==ht?ht:lt-C.bottom<n)?k:L)+ot,et=P+(nt&&C.width||0)+window.pageXOffset,et="text"==ct&&Z?"right: 0;":"left: ".concat(et,"px;"),it.style.cssText="".concat(et," top: ").concat(tt,"px; min-width: ").concat(j,"; max-width: ").concat(j),it.setAttribute("placement",Y?"top":"bottom"),it.setAttribute("position",ct)}}}})?k:{},Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(k)):function(n,D){var A=Object.keys(n);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(n);D&&(C=C.filter((function(D){return Object.getOwnPropertyDescriptor(n,D).enumerable}))),A.push.apply(A,C)}return A}(Object(k)).forEach((function(n){Object.defineProperty(C,n,Object.getOwnPropertyDescriptor(k,n))})),C),P="@yaireo/tagify/",j={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},K={wrapper:function(D,A){return'<tags class="'.concat(A.classNames.namespace," ").concat(A.mode?"".concat(A.classNames[A.mode+"Mode"]):""," ").concat(D.className,'"\n                    ').concat(A.readonly?"readonly":"","\n                    ").concat(A.disabled?"disabled":"","\n                    ").concat(A.required?"required":"","\n                    ").concat("select"===A.mode?"spellcheck='false'":"",'\n                    tabIndex="-1">\n                    ').concat(this.settings.templates.input.call(this),"\n                ").concat(n,"\n        </tags>")},input:function(){var D=this.settings,A=D.placeholder||n;return"<span ".concat(!D.readonly&&D.userInput?"contenteditable":"",' tabIndex="0" data-placeholder="').concat(A,'" aria-placeholder="').concat(D.placeholder||"",'"\n                    class="').concat(D.classNames.input,'"\n                    role="textbox"\n                    autocapitalize="false"\n                    autocorrect="off"\n                    aria-autocomplete="both"\n                    aria-multiline="').concat("mix"==D.mode,'"></span>')},tag:function(n,D){var A=D.settings;return'<tag title="'.concat(n.title||n.value,"\"\n                    contenteditable='false'\n                    tabIndex=\"").concat(A.a11y.focusableTags?0:-1,'"\n                    class="').concat(A.classNames.tag," ").concat(n.class||"",'"\n                    ').concat(this.getAttributes(n),">\n            <x title='' tabIndex=\"").concat(A.a11y.focusableTags?0:-1,'" class="').concat(A.classNames.tagX,"\" role='button' aria-label='remove tag'></x>\n            <div>\n                <span ").concat("select"===A.mode&&A.userInput?"contenteditable='true'":"",' autocapitalize="false" autocorrect="off" spellcheck=\'false\' class="').concat(A.classNames.tagText,'">').concat(n[A.tagTextProp]||n.value,"</span>\n            </div>\n        </tag>")},dropdown:function(n){var D=n.dropdown,A="manual"==D.position;return'<div class="'.concat(A?"":n.classNames.dropdown," ").concat(D.classname,'" role="listbox" aria-labelledby="dropdown" dir="').concat(D.RTL?"rtl":"","\">\n                    <div data-selector='tagify-suggestions-wrapper' class=\"").concat(n.classNames.dropdownWrapper,'"></div>\n                </div>')},dropdownContent:function(n){var D=this.settings.templates,A=this.state.dropdown.suggestions;return"\n            ".concat(D.dropdownHeader.call(this,A),"\n            ").concat(n,"\n            ").concat(D.dropdownFooter.call(this,A),"\n        ")},dropdownItem:function(n){return"<div ".concat(this.getAttributes(n),"\n                    class='").concat(this.settings.classNames.dropdownItem," ").concat(this.isTagDuplicate(n.value)?this.settings.classNames.dropdownItemSelected:""," ").concat(n.class||"",'\'\n                    tabindex="0"\n                    role="option">').concat(n.mappedValue||n.value,"</div>")},dropdownHeader:function(n){return"<header data-selector='tagify-suggestions-header' class=\"".concat(this.settings.classNames.dropdownHeader,'"></header>')},dropdownFooter:function(n){var D=n.length-this.settings.dropdown.maxItems;return D>0?"<footer data-selector='tagify-suggestions-footer' class=\"".concat(this.settings.classNames.dropdownFooter,'">\n                ').concat(D," more items. Refine your search.\n            </footer>"):""},dropdownItemNoMatch:null};function V(n,D){(null==D||D>n.length)&&(D=n.length);for(var A=0,C=new Array(D);A<D;A++)C[A]=n[A];return C}function R(n,D){return null!=D&&"undefined"!=typeof Symbol&&D[Symbol.hasInstance]?!!D[Symbol.hasInstance](n):n instanceof D}function F(n,D){return function(n){if(Array.isArray(n))return n}(n)||function(n,D){var A=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=A){var C,k,L=[],P=!0,j=!1;try{for(A=A.call(n);!(P=(C=A.next()).done)&&(L.push(C.value),!D||L.length!==D);P=!0);}catch(n){j=!0,k=n}finally{try{P||null==A.return||A.return()}finally{if(j)throw k}}return L}}(n,D)||function(n,D){if(n){if("string"==typeof n)return V(n,D);var A=Object.prototype.toString.call(n).slice(8,-1);"Object"===A&&n.constructor&&(A=n.constructor.name);return"Map"===A||"Set"===A?Array.from(A):"Arguments"===A||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A)?V(n,D):void 0}}(n,D)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(n,D){(null==D||D>n.length)&&(D=n.length);for(var A=0,C=new Array(D);A<D;A++)C[A]=n[A];return C}function B(n,D,A){return D in n?Object.defineProperty(n,D,{value:A,enumerable:!0,configurable:!0,writable:!0}):n[D]=A,n}function W(n,D){return null!=D&&"undefined"!=typeof Symbol&&D[Symbol.hasInstance]?!!D[Symbol.hasInstance](n):n instanceof D}function U(n,D){return D=null!=D?D:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(D)):function(n,D){var A=Object.keys(n);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(n);D&&(C=C.filter((function(D){return Object.getOwnPropertyDescriptor(n,D).enumerable}))),A.push.apply(A,C)}return A}(Object(D)).forEach((function(A){Object.defineProperty(n,A,Object.getOwnPropertyDescriptor(D,A))})),n}function q(n){return function(n){if(Array.isArray(n))return H(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,D){if(n){if("string"==typeof n)return H(n,D);var A=Object.prototype.toString.call(n).slice(8,-1);"Object"===A&&n.constructor&&(A=n.constructor.name);return"Map"===A||"Set"===A?Array.from(A):"Arguments"===A||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A)?H(n,D):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Y={customBinding:function(){var n=this;this.customEventsList.forEach((function(D){n.on(D,n.settings.callbacks[D])}))},binding:function(){var n,D=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],A=this.settings,C=this.events.callbacks,k=D?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!D){for(var L in this.state.mainEvents=D,D&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),n=this.listeners.main=this.listeners.main||{keydown:["input",C.onKeydown.bind(this)],click:["scope",C.onClickScope.bind(this)],dblclick:"select"!=A.mode&&["scope",C.onDoubleClickScope.bind(this)],paste:["input",C.onPaste.bind(this)],drop:["input",C.onDrop.bind(this)],compositionstart:["input",C.onCompositionStart.bind(this)],compositionend:["input",C.onCompositionEnd.bind(this)]})n[L]&&this.DOM[n[L][0]][k](L,n[L][1]);var P=this.listeners.main.inputMutationObserver||new MutationObserver(C.onInputDOMChange.bind(this));P.disconnect(),"mix"==A.mode&&P.observe(this.DOM.input,{childList:!0}),this.events.bindOriginaInputListener.call(this)}},bindOriginaInputListener:function(n){var D=(n||0)+500;this.listeners.main&&(clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(this.events.callbacks.observeOriginalInputValue.bind(this),D))},bindGlobal:function(n){var D,A=this.events.callbacks,C=n?"removeEventListener":"addEventListener";if(this.listeners&&(n||!this.listeners.global)){this.listeners.global=this.listeners.global||[{type:this.isIE?"keydown":"input",target:this.DOM.input,cb:A[this.isIE?"onInputIE":"onInput"].bind(this)},{type:"keydown",target:window,cb:A.onWindowKeyDown.bind(this)},{type:"focusin",target:this.DOM.scope,cb:A.onFocusBlur.bind(this)},{type:"focusout",target:this.DOM.scope,cb:A.onFocusBlur.bind(this)},{type:"click",target:document,cb:A.onClickAnywhere.bind(this),useCapture:!0}];var k=!0,L=!1,P=void 0;try{for(var j,K=this.listeners.global[Symbol.iterator]();!(k=(j=K.next()).done);k=!0)(D=j.value).target[C](D.type,D.cb,!!D.useCapture)}catch(n){L=!0,P=n}finally{try{k||null==K.return||K.return()}finally{if(L)throw P}}}},unbindGlobal:function(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur:function(n){var D,A,C=this.settings,k=v.call(this,n.relatedTarget),L=m.call(this,n.relatedTarget),P=n.target.classList.contains(C.classNames.tagX),j="focusin"==n.type,K="focusout"==n.type;P&&"mix"!=C.mode&&this.DOM.input.focus(),k&&j&&!L&&!P&&this.toggleFocusClass(this.state.hasFocus=+new Date);var Y=n.target?this.trim(this.DOM.input.textContent):"",Z=null===(A=this.value)||void 0===A||null===(D=A[0])||void 0===D?void 0:D[C.tagTextProp],tt=C.dropdown.enabled>=0,et={relatedTarget:n.relatedTarget},it=this.state.actions.selectOption&&(tt||!C.dropdown.closeOnSelect),nt=this.state.actions.addNew&&tt;if(K){if(n.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),C.onChangeAfterBlur&&this.triggerChangeEvent()}if(!(it||nt||P))if(this.state.hasFocus=!(!j&&!k)&&+new Date,this.toggleFocusClass(this.state.hasFocus),"mix"!=C.mode){if(j){if(!C.focusable)return;var st=0===C.dropdown.enabled&&!this.state.dropdown.visible,at=!L||"select"===C.mode,ot=this.DOM.scope.querySelector(this.settings.classNames.tagTextSelector);return this.trigger("focus",et),void(st&&at&&(this.dropdown.show(this.value.length?"":void 0),this.setRangeAtStartEnd(!1,ot)))}if(K){if(this.trigger("blur",et),this.loading(!1),"select"==C.mode){if(this.value.length){var rt=this.getTagElms()[0];Y=this.trim(rt.textContent)}Z===Y&&(Y="")}Y&&!this.state.actions.selectOption&&C.addTagOnBlur&&C.addTagOn.includes("blur")&&this.addTags(Y,!0)}k||(this.DOM.input.removeAttribute("style"),this.dropdown.hide())}else j?this.trigger("focus",et):K&&(this.trigger("blur",et),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart:function(n){this.state.composing=!0},onCompositionEnd:function(n){this.state.composing=!1},onWindowKeyDown:function(n){var D,A=this.settings,C=document.activeElement,k=v.call(this,C)&&this.DOM.scope.contains(C),L=C===this.DOM.input,P=k&&C.hasAttribute("readonly"),j=this.DOM.scope.querySelector(this.settings.classNames.tagTextSelector),K=this.state.dropdown.visible;if(("Tab"===n.key&&K||this.state.hasFocus||k&&!P)&&!L){D=C.nextElementSibling;var Y=n.target.classList.contains(A.classNames.tagX);switch(n.key){case"Backspace":A.readonly||this.state.editing||(this.removeTags(C),(D||this.DOM.input).focus());break;case"Enter":if(Y)return void this.removeTags(n.target.parentNode);A.a11y.focusableTags&&m.call(this,C)&&setTimeout(this.editTag.bind(this),0,C);break;case"ArrowDown":this.state.dropdown.visible||"mix"==A.mode||this.dropdown.show();break;case"Tab":null==j||j.focus()}}},onKeydown:function(n){var D=this,A=this.settings;if(!this.state.composing&&A.userInput){"select"==A.mode&&A.enforceWhitelist&&this.value.length&&"Tab"!=n.key&&n.preventDefault();var C=this.trim(n.target.textContent);this.trigger("keydown",{event:n}),A.hooks.beforeKeyDown(n,{tagify:this}).then((function(k){if("mix"==A.mode){switch(n.key){case"Left":case"ArrowLeft":D.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(D.state.editing)return;var L=document.getSelection(),P="Delete"==n.key&&L.anchorOffset==(L.anchorNode.length||0),j=L.anchorNode.previousSibling,K=1==L.anchorNode.nodeType||!L.anchorOffset&&j&&1==j.nodeType&&L.anchorNode.previousSibling;!function(n){var D=document.createElement("div");n.replace(/\&#?[0-9a-z]+;/gi,(function(n){return D.innerHTML=n,D.innerText}))}(D.DOM.input.innerHTML);var Y,Z,tt,et=D.getTagElms(),it=1===L.anchorNode.length&&L.anchorNode.nodeValue==String.fromCharCode(8203);if("edit"==A.backspace&&K)return Y=1==L.anchorNode.nodeType?null:L.anchorNode.previousElementSibling,setTimeout(D.editTag.bind(D),0,Y),void n.preventDefault();if(p()&&W(K,Element))return tt=l(K),K.hasAttribute("readonly")||K.remove(),D.DOM.input.focus(),void setTimeout((function(){T(tt),D.DOM.input.click()}));if("BR"==L.anchorNode.nodeName)return;if((P||K)&&1==L.anchorNode.nodeType?Z=0==L.anchorOffset?P?et[0]:null:et[Math.min(et.length,L.anchorOffset)-1]:P?Z=L.anchorNode.nextElementSibling:W(K,Element)&&(Z=K),3==L.anchorNode.nodeType&&!L.anchorNode.nodeValue&&L.anchorNode.previousElementSibling&&n.preventDefault(),(K||P)&&!A.backspace)return void n.preventDefault();if("Range"!=L.type&&!L.anchorOffset&&L.anchorNode==D.DOM.input&&"Delete"!=n.key)return void n.preventDefault();if("Range"!=L.type&&Z&&Z.hasAttribute("readonly"))return void T(l(Z));"Delete"==n.key&&it&&y(L.anchorNode.nextSibling)&&D.removeTags(L.anchorNode.nextSibling)}return!0}var nt="manual"==A.dropdown.position;switch(n.key){case"Backspace":"select"==A.mode&&A.enforceWhitelist&&D.value.length?D.removeTags():D.state.dropdown.visible&&"manual"!=A.dropdown.position||""!=n.target.textContent&&8203!=C.charCodeAt(0)||(!0===A.backspace?D.removeTags():"edit"==A.backspace&&setTimeout(D.editTag.bind(D),0));break;case"Esc":case"Escape":if(D.state.dropdown.visible)return;n.target.blur();break;case"Down":case"ArrowDown":D.state.dropdown.visible||D.dropdown.show();break;case"ArrowRight":var st=D.state.inputSuggestion||D.state.ddItemData;if(st&&A.autoComplete.rightKey)return void D.addTags([st],!0);break;case"Tab":return!0;case"Enter":if(D.state.dropdown.visible&&!nt)return;n.preventDefault();var at=D.state.autoCompleteData||C;setTimeout((function(){D.state.dropdown.visible&&!nt||D.state.actions.selectOption||!A.addTagOn.includes(n.key.toLowerCase())||(D.addTags([at],!0),D.state.autoCompleteData=null)}))}})).catch((function(n){return n}))}},onInput:function(n){this.postUpdate();var D=this.settings;if("mix"==D.mode)return this.events.callbacks.onMixTagsInput.call(this,n);var A=this.input.normalize.call(this,void 0,{trim:!1}),C=A.length>=D.dropdown.enabled,k={value:A,inputElm:this.DOM.input},L=this.validateTag({value:A});"select"==D.mode&&this.toggleScopeValidation(L),k.isValid=L,this.state.inputText!=A&&(this.input.set.call(this,A,!1),-1!=A.search(D.delimiters)?this.addTags(A)&&this.input.set.call(this):D.dropdown.enabled>=0&&this.dropdown[C?"show":"hide"](A),this.trigger("input",k))},onMixTagsInput:function(n){var D,A,C,k,L,P,j,K,Y=this,Z=this.settings,tt=this.value.length,et=this.getTagElms(),it=document.createDocumentFragment(),nt=window.getSelection().getRangeAt(0),st=[].map.call(et,(function(n){return y(n).value}));if("deleteContentBackward"==n.inputType&&p()&&this.events.callbacks.onKeydown.call(this,{target:n.target,key:"Backspace"}),O(this.getTagElms()),this.value.slice().forEach((function(n){n.readonly&&!st.includes(n.value)&&it.appendChild(Y.createTagElem(n))})),it.childNodes.length&&(nt.insertNode(it),this.setRangeAtStartEnd(!1,it.lastChild)),et.length!=tt)return this.value=[].map.call(this.getTagElms(),(function(n){return y(n)})),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(P=window.getSelection()).rangeCount>0&&3==P.anchorNode.nodeType){if((nt=P.getRangeAt(0).cloneRange()).collapse(!0),nt.setStart(P.focusNode,0),C=(D=nt.toString().slice(0,nt.endOffset)).split(Z.pattern).length-1,(A=D.match(Z.pattern))&&(k=D.slice(D.lastIndexOf(A[A.length-1]))),k){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:k.match(Z.pattern)[0],value:k.replace(Z.pattern,"")},this.state.tag.baseOffset=P.baseOffset-this.state.tag.value.length,K=this.state.tag.value.match(Z.delimiters))return this.state.tag.value=this.state.tag.value.replace(Z.delimiters,""),this.state.tag.delimiters=K[0],this.addTags(this.state.tag.value,Z.dropdown.clearOnSelect),void this.dropdown.hide();L=this.state.tag.value.length>=Z.dropdown.enabled;try{j=(j=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&j.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(n){}(j||C<this.state.mixMode.matchedPatternCount)&&(L=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=C}setTimeout((function(){Y.update({withoutChangeEvent:!0}),Y.trigger("input",u({},Y.state.tag,{textContent:Y.DOM.input.textContent})),Y.state.tag&&Y.dropdown[L?"show":"hide"](Y.state.tag.value)}),10)},onInputIE:function(n){var D=this;setTimeout((function(){D.events.callbacks.onInput.call(D,n)}))},observeOriginalInputValue:function(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere:function(n){if(n.target!=this.DOM.scope&&!this.DOM.scope.contains(n.target)){this.toggleFocusClass(!1),this.state.hasFocus=!1;var D=n.target.closest(this.settings.classNames.dropdownSelector);(null==D?void 0:D.__tagify)!=this&&this.dropdown.hide()}},onClickScope:function(n){var D=this.settings,A=n.target.closest("."+D.classNames.tag),C=n.target===this.DOM.scope,k=+new Date-this.state.hasFocus;if(C&&"select"!=D.mode)this.DOM.input.focus();else{if(!n.target.classList.contains(D.classNames.tagX))return A&&!this.state.editing?(this.trigger("click",{tag:A,index:this.getNodeIndex(A),data:y(A),event:n}),void(1!==D.editTags&&1!==D.editTags.clicks&&"select"!=D.mode||this.events.callbacks.onDoubleClickScope.call(this,n))):void(n.target==this.DOM.input&&("mix"==D.mode&&this.fixFirefoxLastTagNoCaret(),k>500||!D.focusable)?this.state.dropdown.visible?this.dropdown.hide():0===D.dropdown.enabled&&"mix"!=D.mode&&this.dropdown.show(this.value.length?"":void 0):"select"!=D.mode||0!==D.dropdown.enabled||this.state.dropdown.visible||(this.events.callbacks.onDoubleClickScope.call(this,U(function(n){for(var D=1;D<arguments.length;D++){var A=null!=arguments[D]?arguments[D]:{},C=Object.keys(A);"function"==typeof Object.getOwnPropertySymbols&&(C=C.concat(Object.getOwnPropertySymbols(A).filter((function(n){return Object.getOwnPropertyDescriptor(A,n).enumerable})))),C.forEach((function(D){B(n,D,A[D])}))}return n}({},n),{target:this.getTagElms()[0]})),!D.userInput&&this.dropdown.show()));this.removeTags(n.target.parentNode)}},onPaste:function(n){var D=this;n.preventDefault();var A,C,k,L=this.settings;if(!L.userInput)return!1;L.readonly||(C=n.clipboardData||window.clipboardData,k=C.getData("Text"),L.hooks.beforePaste(n,{tagify:this,pastedText:k,clipboardData:C}).then((function(L){void 0===L&&(L=k),L&&(D.injectAtCaret(L,window.getSelection().getRangeAt(0)),"mix"==D.settings.mode?D.events.callbacks.onMixTagsInput.call(D,n):D.settings.pasteAsTags?A=D.addTags(D.state.inputText+L,!0):(D.state.inputText=L,D.dropdown.show(L))),D.trigger("paste",{event:n,pastedText:k,clipboardData:C,tagsElems:A})})).catch((function(n){return n})))},onDrop:function(n){n.preventDefault()},onEditTagInput:function(n,D){var A,C=n.closest("."+this.settings.classNames.tag),k=this.getNodeIndex(C),L=y(C),P=this.input.normalize.call(this,n),j=(B(A={},this.settings.tagTextProp,P),B(A,"__tagId",L.__tagId),A),K=this.validateTag(j);this.editTagChangeDetected(u(L,j))||!0!==n.originalIsValid||(K=!0),C.classList.toggle(this.settings.classNames.tagInvalid,!0!==K),L.__isValid=K,C.title=!0===K?L.title||L.value:K,P.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=P),this.dropdown.show(P)),this.trigger("edit:input",{tag:C,index:k,data:u({},this.value[k],{newValue:P}),event:D})},onEditTagPaste:function(n,D){var A=(D.clipboardData||window.clipboardData).getData("Text");D.preventDefault();var C=w(A);this.setRangeAtStartEnd(!1,C)},onEditTagClick:function(n,D){this.events.callbacks.onClickScope.call(this,D)},onEditTagFocus:function(n){this.state.editing={scope:n,input:n.querySelector("[contenteditable]")}},onEditTagBlur:function(n,D){var A=m.call(this,D.relatedTarget);if("select"==this.settings.mode&&A&&D.relatedTarget.contains(D.target))this.dropdown.hide();else if(this.state.editing&&(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(document.activeElement)||this.trigger("blur",{}),this.DOM.scope.contains(n))){var C,k,L,P=this.settings,j=n.closest("."+P.classNames.tag),K=y(j),Y=this.input.normalize.call(this,n),Z=(B(C={},P.tagTextProp,Y),B(C,"__tagId",K.__tagId),C),tt=K.__originalData,et=this.editTagChangeDetected(u(K,Z)),it=this.validateTag(Z);if(Y)if(et){var nt;if(k=this.hasMaxTags(),L=u({},tt,(B(nt={},P.tagTextProp,this.trim(Y)),B(nt,"__isValid",it),nt)),P.transformTag.call(this,L,tt),!0!==(it=(!k||!0===tt.__isValid)&&this.validateTag(L))){if(this.trigger("invalid",{data:L,tag:j,message:it}),P.editTags.keepInvalid)return;P.keepInvalidTags?L.__isValid=it:L=tt}else P.keepInvalidTags&&(delete L.title,delete L["aria-invalid"],delete L.class);this.onEditTagDone(j,L)}else this.onEditTagDone(j,tt);else this.onEditTagDone(j)}},onEditTagkeydown:function(n,D){if(!this.state.composing)switch(this.trigger("edit:keydown",{event:n}),n.key){case"Esc":case"Escape":this.state.editing=!1,!D.__tagifyTagData.__originalData.value?D.remove():D.parentNode.replaceChild(D.__tagifyTagData.__originalHTML,D);break;case"Enter":case"Tab":n.preventDefault();setTimeout((function(){return n.target.blur()}),0)}},onDoubleClickScope:function(n){var D=n.target.closest("."+this.settings.classNames.tag);if(D){var A,C,k=y(D),L=this.settings;!1!==(null==k?void 0:k.editable)&&(A=D.classList.contains(this.settings.classNames.tagEditing),C=D.hasAttribute("readonly"),L.readonly||A||C||!this.settings.editTags||!L.userInput||(this.events.callbacks.onEditTagFocus.call(this,D),this.editTag(D)),this.toggleFocusClass(!0),"select"!=L.mode&&this.trigger("dblclick",{tag:D,index:this.getNodeIndex(D),data:y(D)}))}},onInputDOMChange:function(n){var D=this;n.forEach((function(n){n.addedNodes.forEach((function(n){if("<div><br></div>"==n.outerHTML)n.replaceWith(document.createElement("br"));else if(1==n.nodeType&&n.querySelector(D.settings.classNames.tagSelector)){var A,C=document.createTextNode("");3==n.childNodes[0].nodeType&&"BR"!=n.previousSibling.nodeName&&(C=document.createTextNode("\n")),(A=n).replaceWith.apply(A,q([C].concat(q(q(n.childNodes).slice(0,-1))))),T(C)}else if(m.call(D,n)){var k;if(3!=(null===(k=n.previousSibling)||void 0===k?void 0:k.nodeType)||n.previousSibling.textContent||n.previousSibling.remove(),n.previousSibling&&"BR"==n.previousSibling.nodeName){n.previousSibling.replaceWith("\n​");for(var L=n.nextSibling,P="";L;)P+=L.textContent,L=L.nextSibling;P.trim()&&T(n.previousSibling)}else n.previousSibling&&!y(n.previousSibling)||n.before("​")}})),n.removedNodes.forEach((function(n){n&&"BR"==n.nodeName&&m.call(D,A)&&(D.removeTags(A),D.fixFirefoxLastTagNoCaret())}))}));var A=this.DOM.input.lastChild;A&&""==A.nodeValue&&A.remove(),A&&"BR"==A.nodeName||this.DOM.input.appendChild(document.createElement("br"))}}};function z(n,D){(null==D||D>n.length)&&(D=n.length);for(var A=0,C=new Array(D);A<D;A++)C[A]=n[A];return C}function X(n,D,A){return D in n?Object.defineProperty(n,D,{value:A,enumerable:!0,configurable:!0,writable:!0}):n[D]=A,n}function J(n,D){return null!=D&&"undefined"!=typeof Symbol&&D[Symbol.hasInstance]?!!D[Symbol.hasInstance](n):n instanceof D}function G(n){for(var D=1;D<arguments.length;D++){var A=null!=arguments[D]?arguments[D]:{},C=Object.keys(A);"function"==typeof Object.getOwnPropertySymbols&&(C=C.concat(Object.getOwnPropertySymbols(A).filter((function(n){return Object.getOwnPropertyDescriptor(A,n).enumerable})))),C.forEach((function(D){X(n,D,A[D])}))}return n}function $(n){return function(n){if(Array.isArray(n))return z(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,D){if(n){if("string"==typeof n)return z(n,D);var A=Object.prototype.toString.call(n).slice(8,-1);"Object"===A&&n.constructor&&(A=n.constructor.name);return"Map"===A||"Set"===A?Array.from(A):"Arguments"===A||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(A)?z(n,D):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(n,A){if(!n){D.warn("input element not found",n);var C=new Proxy(this,{get:function(){return function(){return C}}});return C}if(n.__tagify)return D.warn("input element is already Tagified - Same instance is returned.",n),n.__tagify;var k;u(this,function(n){var A=document.createTextNode(""),C={};function s(n,D,C){C&&D.split(/\s+/g).forEach((function(D){return A[n+"EventListener"].call(A,D,C)}))}return{removeAllCustomListeners:function(){Object.entries(C).forEach((function(n){var D=F(n,2),A=D[0];D[1].forEach((function(n){return s("remove",A,n)}))})),C={}},off:function(n,D){return n&&(D?s("remove",n,D):n.split(/\s+/g).forEach((function(n){var D;null===(D=C[n])||void 0===D||D.forEach((function(D){return s("remove",n,D)})),delete C[n]}))),this},on:function(n,D){return D&&"function"==typeof D&&(n.split(/\s+/g).forEach((function(n){Array.isArray(C[n])?C[n].push(D):C[n]=[D]})),s("add",n,D)),this},trigger:function(C,k,L){var P;if(L=L||{cloneData:!0},C)if(n.settings.isJQueryPlugin)"remove"==C&&(C="removeTag"),jQuery(n.DOM.originalInput).triggerHandler(C,[k]);else{try{var j="object"==typeof k?k:{value:k};if((j=L.cloneData?u({},j):j).tagify=this,k.event&&(j.event=this.cloneEvent(k.event)),R(k,Object))for(var K in k)R(k[K],HTMLElement)&&(j[K]=k[K]);P=new CustomEvent(C,{detail:j})}catch(n){D.warn(n)}A.dispatchEvent(P)}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,A=A||{},this.getPersistedData=(k=A.id,function(n){var D;if(k){var A,C="/"+n;if(1===(null===(D=localStorage)||void 0===D?void 0:D.getItem(P+k+"/v")))try{A=JSON.parse(localStorage[P+k+C])}catch(n){}return A}}),this.setPersistedData=function(n){var D;return n?(null===(D=localStorage)||void 0===D||D.setItem(P+n+"/v",1),function(D,A){var C,k="/"+A,L=JSON.stringify(D);D&&A&&(null===(C=localStorage)||void 0===C||C.setItem(P+n+k,L),dispatchEvent(new Event("storage")))}):function(){}}(A.id),this.clearPersistedData=function(n){return function(D){var A=P+"/"+n+"/";if(D)localStorage.removeItem(A+D);else for(var C in localStorage)C.includes(A)&&localStorage.removeItem(C)}}(A.id),this.applySettings(n,A),this.state={inputText:"",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(n),_.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),n.autofocus&&this.DOM.input.focus(),n.__tagify=this}Q.prototype={_dropdown:L,placeCaretAfterNode:T,getSetTagData:y,helpers:{sameStr:s,removeCollectionProp:a,omit:o,isObject:c,parseHTML:r,escapeHTML:d,extend:u,concatWithoutDups:g,getUID:f,isNodeTag:m},customEventsList:["change","add","remove","invalid","input","paste","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim:function(n){return this.settings.trim&&n&&"string"==typeof n?n.trim():n},parseHTML:r,templates:K,parseTemplate:function(n,D){return r((n=this.settings.templates[n]||n).apply(this,D))},set whitelist(n){var D=n&&Array.isArray(n);this.settings.whitelist=D?n:[],this.setPersistedData(D?n:[],"whitelist")},get whitelist(){return this.settings.whitelist},set userInput(n){this.settings.userInput=!!n,this.setContentEditable(!!n)},get userInput(){return this.settings.userInput},generateClassSelectors:function(n){var e=function(D){var A=D;Object.defineProperty(n,A+"Selector",{get:function(){return"."+this[A].split(" ")[0]}})};for(var D in n)e(D)},applySettings:function(n,D){var C,k;A.templates=this.templates;var L=u({},A,"mix"==D.mode?{dropdown:{position:"text"}}:{}),P=this.settings=u({},L,D);if(P.disabled=n.hasAttribute("disabled"),P.readonly=P.readonly||n.hasAttribute("readonly"),P.placeholder=d(n.getAttribute("placeholder")||P.placeholder||""),P.required=n.hasAttribute("required"),this.generateClassSelectors(P.classNames),this.isIE&&(P.autoComplete=!1),["whitelist","blacklist"].forEach((function(D){var A=n.getAttribute("data-"+D);A&&J(A=A.split(P.delimiters),Array)&&(P[D]=A)})),"autoComplete"in D&&!c(D.autoComplete)&&(P.autoComplete=A.autoComplete,P.autoComplete.enabled=D.autoComplete),"mix"==P.mode&&(P.pattern=P.pattern||/@/,P.autoComplete.rightKey=!0,P.delimiters=D.delimiters||null,P.tagTextProp&&!P.dropdown.searchKeys.includes(P.tagTextProp)&&P.dropdown.searchKeys.push(P.tagTextProp)),n.pattern)try{P.pattern=new RegExp(n.pattern)}catch(n){}if(P.delimiters){P._delimiters=P.delimiters;try{P.delimiters=new RegExp(this.settings.delimiters,"g")}catch(n){}}P.disabled&&(P.userInput=!1),this.TEXTS=G({},j,P.texts||{}),"select"==P.mode&&(P.dropdown.includeSelectedTags=!0),("select"!=P.mode||(null===(C=D.dropdown)||void 0===C?void 0:C.enabled))&&P.userInput||(P.dropdown.enabled=0),P.dropdown.appendTarget=(null===(k=D.dropdown)||void 0===k?void 0:k.appendTarget)||document.body,void 0===P.dropdown.includeSelectedTags&&(P.dropdown.includeSelectedTags=P.duplicates);var K=this.getPersistedData("whitelist");Array.isArray(K)&&(this.whitelist=Array.isArray(P.whitelist)?g(P.whitelist,K):K)},getAttributes:function(n){var D,A=this.getCustomAttributes(n),C="";for(D in A)C+=" "+D+(void 0!==n[D]?'="'.concat(A[D],'"'):"");return C},getCustomAttributes:function(n){if(!c(n))return"";var D,A={};for(D in n)"__"!=D.slice(0,2)&&"class"!=D&&n.hasOwnProperty(D)&&void 0!==n[D]&&(A[D]=d(n[D]));return A},setStateSelection:function(){var n=window.getSelection(),D={anchorOffset:n.anchorOffset,anchorNode:n.anchorNode,range:n.getRangeAt&&n.rangeCount&&n.getRangeAt(0)};return this.state.selection=D,D},getCSSVars:function(){var n,D,A,C=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:(n=function(n){if(!n)return{};var D=(n=n.trim().split(" ")[0]).split(/\d+/g).filter((function(n){return n})).pop().trim();return{value:+n.split(D).filter((function(n){return n}))[0].trim(),unit:D}}((A="tag-hide-transition",C.getPropertyValue("--"+A))),D=n.value,"s"==n.unit?1e3*D:D)}},build:function(n){var D=this.DOM,A=n.closest("label");this.settings.mixMode.integrated?(D.originalInput=null,D.scope=n,D.input=n):(D.originalInput=n,D.originalInput_tabIndex=n.tabIndex,D.scope=this.parseTemplate("wrapper",[n,this.settings]),D.input=D.scope.querySelector(this.settings.classNames.inputSelector),n.parentNode.insertBefore(D.scope,n),n.tabIndex=-1),A&&A.setAttribute("for","")},destroy:function(){var n;this.events.unbindGlobal.call(this),null===(n=this.DOM.scope.parentNode)||void 0===n||n.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),this.removeAllCustomListeners(),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues:function(n){var D,A=this.settings;if(this.state.blockChangeEvent=!0,void 0===n){var C=this.getPersistedData("value");n=C&&!this.DOM.originalInput.value?C:A.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),n)if("mix"==A.mode)this.parseMixTags(n),(D=this.DOM.input.lastChild)&&"BR"==D.tagName||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{J(JSON.parse(n),Array)&&(n=JSON.parse(n))}catch(n){}this.addTags(n,!0).forEach((function(n){return n&&n.classList.add(A.classNames.tagNoAnimation)}))}else this.postUpdate();this.state.lastOriginalValueReported=A.mixMode.integrated?"":this.DOM.originalInput.value},cloneEvent:function(n){var D={};for(var A in n)"path"!=A&&(D[A]=n[A]);return D},loading:function(n){return this.state.isLoading=n,this.DOM.scope.classList[n?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading:function(n,D){return n&&n.classList[D?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass:function(n,D){"string"==typeof n&&this.DOM.scope.classList.toggle(n,D)},toggleScopeValidation:function(n){var D=!0===n||void 0===n;!this.settings.required&&n&&n===this.TEXTS.empty&&(D=!0),this.toggleClass(this.settings.classNames.tagInvalid,!D),this.DOM.scope.title=D?"":n},toggleFocusClass:function(n){this.toggleClass(this.settings.classNames.focus,!!n)},setPlaceholder:function(n){var D=this;["data","aria"].forEach((function(A){return D.DOM.input.setAttribute("".concat(A,"-placeholder"),n)}))},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var n=this.DOM.originalInput,D=this.state.lastOriginalValueReported!==n.value,A=new CustomEvent("change",{bubbles:!0});D&&(this.state.lastOriginalValueReported=n.value,A.simulated=!0,n._valueTracker&&n._valueTracker.setValue(Math.random()),n.dispatchEvent(A),this.trigger("change",this.state.lastOriginalValueReported),n.value=this.state.lastOriginalValueReported)}},events:Y,fixFirefoxLastTagNoCaret:function(){},setRangeAtStartEnd:function(n,D){if(D){n="number"==typeof n?n:!!n,D=D.lastChild||D;var A=document.getSelection();if(J(A.focusNode,Element)&&!this.DOM.input.contains(A.focusNode))return!0;try{A.rangeCount>=1&&["Start","End"].forEach((function(C){return A.getRangeAt(0)["set"+C](D,n||D.length)}))}catch(n){console.warn(n)}}},insertAfterTag:function(n,D){if(D=D||this.settings.mixMode.insertAfterTag,n&&n.parentNode&&D)return D="string"==typeof D?document.createTextNode(D):D,n.parentNode.insertBefore(D,n.nextSibling),D},editTagChangeDetected:function(n){var D=n.__originalData;for(var A in D)if(!this.dataProps.includes(A)&&n[A]!=D[A])return!0;return!1},getTagTextNode:function(n){return n.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode:function(n,D){this.getTagTextNode(n).innerHTML=d(D)},editTag:function(n,A){var C=this;n=n||this.getLastTag(),A=A||{};var k=this.settings,L=this.getTagTextNode(n),P=this.getNodeIndex(n),j=y(n),K=this.events.callbacks,Y=!0,Z="select"==k.mode;if(!Z&&this.dropdown.hide(),L){if(!J(j,Object)||!("editable"in j)||j.editable)return j=y(n,{__originalData:u({},j),__originalHTML:n.cloneNode(!0)}),y(j.__originalHTML,j.__originalData),L.setAttribute("contenteditable",!0),n.classList.add(k.classNames.tagEditing),this.events.callbacks.onEditTagFocus.call(this,n),L.addEventListener("click",K.onEditTagClick.bind(this,n)),L.addEventListener("blur",K.onEditTagBlur.bind(this,this.getTagTextNode(n))),L.addEventListener("input",K.onEditTagInput.bind(this,L)),L.addEventListener("paste",K.onEditTagPaste.bind(this,L)),L.addEventListener("keydown",(function(D){return K.onEditTagkeydown.call(C,D,n)})),L.addEventListener("compositionstart",K.onCompositionStart.bind(this)),L.addEventListener("compositionend",K.onCompositionEnd.bind(this)),A.skipValidation||(Y=this.editTagToggleValidity(n)),L.originalIsValid=Y,this.trigger("edit:start",{tag:n,index:P,data:j,isValid:Y}),L.focus(),!Z&&this.setRangeAtStartEnd(!1,L),0===k.dropdown.enabled&&!Z&&this.dropdown.show(),this.state.hasFocus=!0,this}else D.warn("Cannot find element in Tag template: .",k.classNames.tagTextSelector)},editTagToggleValidity:function(n,A){var C;if(A=A||y(n))return(C=!("__isValid"in A)||!0===A.__isValid)||this.removeTagsFromValue(n),this.update(),n.classList.toggle(this.settings.classNames.tagNotAllowed,!C),A.__isValid=C,A.__isValid;D.warn("tag has no data: ",n,A)},onEditTagDone:function(n,D){n=n||this.state.editing.scope,D=D||{};var A,C,k=this.settings,L={tag:n,index:this.getNodeIndex(n),previousData:y(n),data:D};this.trigger("edit:beforeUpdate",L,{cloneData:!1}),this.state.editing=!1,delete D.__originalData,delete D.__originalHTML,n&&n.parentNode&&((void 0!==(C=D[k.tagTextProp])?null===(A=(C+="").trim)||void 0===A?void 0:A.call(C):k.tagTextProp in D?void 0:D.value)?(n=this.replaceTag(n,D),this.editTagToggleValidity(n,D),k.a11y.focusableTags?n.focus():"select"!=k.mode&&T(n)):this.removeTags(n)),this.trigger("edit:updated",L),k.dropdown.closeOnSelect&&this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag:function(n,D){D&&""!==D.value&&void 0!==D.value||(D=n.__tagifyTagData),D.__isValid&&1!=D.__isValid&&u(D,this.getInvalidTagAttrs(D,D.__isValid));var A=this.createTagElem(D);return n.parentNode.replaceChild(A,n),this.updateValueByDOMTags(),A},updateValueByDOMTags:function(){var n=this;this.value.length=0;var D=this.settings.classNames,A=[D.tagNotAllowed.split(" ")[0],D.tagHide];[].forEach.call(this.getTagElms(),(function(D){$(D.classList).some((function(n){return A.includes(n)}))||n.value.push(y(D))})),this.update(),this.dropdown.refilter()},injectAtCaret:function(n,D){var A;if(D=D||(null===(A=this.state.selection)||void 0===A?void 0:A.range),"string"==typeof n&&(n=document.createTextNode(n)),!D&&n)return this.appendMixTags(n),this;var C=w(n,D);return this.setRangeAtStartEnd(!1,C),this.updateValueByDOMTags(),this.update(),this},input:{set:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=this.settings,C=A.dropdown.closeOnSelect;this.state.inputText=n,D&&(this.DOM.input.innerHTML=d(""+n),n&&this.toggleClass(A.classNames.empty,!this.DOM.input.innerHTML)),!n&&C&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw:function(){return this.DOM.input.textContent},validate:function(){var n=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!n),n},normalize:function(n,D){var A=n||this.DOM.input,C=[];A.childNodes.forEach((function(n){return 3==n.nodeType&&C.push(n.nodeValue)})),C=C.join("\n");try{C=C.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch(n){}return C=C.replace(/\s/g," "),(null==D?void 0:D.trim)?this.trim(C):C},autocomplete:{suggest:function(n){if(this.settings.autoComplete.enabled){"object"!=typeof(n=n||{value:""})&&(n={value:n});var D=this.dropdown.getMappedValue(n);if("number"!=typeof D){var A=this.state.inputText.toLowerCase(),C=D.substr(0,this.state.inputText.length).toLowerCase(),k=D.substring(this.state.inputText.length);D&&this.state.inputText&&C==A?(this.DOM.input.setAttribute("data-suggest",k),this.state.inputSuggestion=n):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}}},set:function(n){var D=this.DOM.input.getAttribute("data-suggest"),A=n||(D?this.state.inputText+D:null);return!!A&&("mix"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+A)):(this.input.set.call(this,A),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx:function(n){return this.value.findIndex((function(D){return D.__tagId==(n||{}).__tagId}))},getNodeIndex:function(n){var D=0;if(n)for(;n=n.previousElementSibling;)D++;return D},getTagElms:function(){for(var n=arguments.length,D=new Array(n),A=0;A<n;A++)D[A]=arguments[A];var C="."+$(this.settings.classNames.tag.split(" ")).concat($(D)).join(".");return[].slice.call(this.DOM.scope.querySelectorAll(C))},getLastTag:function(){var n=this.settings.classNames,D=this.DOM.scope.querySelectorAll("".concat(n.tagSelector,":not(.").concat(n.tagHide,"):not([readonly])"));return D[D.length-1]},isTagDuplicate:function(n,D,A){var C=0,k=!0,L=!1,P=void 0;try{for(var j,K=this.value[Symbol.iterator]();!(k=(j=K.next()).done);k=!0){var Y=j.value;s(this.trim(""+n),Y.value,D)&&A!=Y.__tagId&&C++}}catch(n){L=!0,P=n}finally{try{k||null==K.return||K.return()}finally{if(L)throw P}}return C},getTagIndexByValue:function(n){var D=this,A=[],C=this.settings.dropdown.caseSensitive;return this.getTagElms().forEach((function(k,L){k.__tagifyTagData&&s(D.trim(k.__tagifyTagData.value),n,C)&&A.push(L)})),A},getTagElmByValue:function(n){var D=this.getTagIndexByValue(n)[0];return this.getTagElms()[D]},flashTag:function(n){var D=this;n&&(n.classList.add(this.settings.classNames.tagFlash),setTimeout((function(){n.classList.remove(D.settings.classNames.tagFlash)}),100))},isTagBlacklisted:function(n){return n=this.trim(n.toLowerCase()),this.settings.blacklist.filter((function(D){return(""+D).toLowerCase()==n})).length},isTagWhitelisted:function(n){return!!this.getWhitelistItem(n)},getWhitelistItem:function(n,D,A){D=D||"value";var C,k=this.settings;return(A=A||k.whitelist).some((function(A){var L="object"==typeof A?A[D]||A.value:A;if(s(L,n,k.dropdown.caseSensitive,k.trim))return C="object"==typeof A?A:{value:A},!0})),C||"value"!=D||"value"==k.tagTextProp||(C=this.getWhitelistItem(n,k.tagTextProp,A)),C},validateTag:function(n){var D=this.settings,A="value"in n?"value":D.tagTextProp,C=this.trim(n[A]+"");return(n[A]+"").trim()?"mix"!=D.mode&&D.pattern&&J(D.pattern,RegExp)&&!D.pattern.test(C)?this.TEXTS.pattern:!D.duplicates&&this.isTagDuplicate(C,D.dropdown.caseSensitive,n.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(C)||D.enforceWhitelist&&!this.isTagWhitelisted(C)?this.TEXTS.notAllowed:!D.validate||D.validate(n):this.TEXTS.empty},getInvalidTagAttrs:function(n,D){return{"aria-invalid":!0,class:"".concat(n.class||""," ").concat(this.settings.classNames.tagNotAllowed).trim(),title:D}},hasMaxTags:function(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly:function(n,D){var A=this.settings;this.DOM.scope.contains(document.activeElement)&&document.activeElement.blur(),A[D||"readonly"]=n,this.DOM.scope[(n?"set":"remove")+"Attribute"](D||"readonly",!0),this.settings.userInput=!0,this.setContentEditable(!n)},setContentEditable:function(n){this.DOM.input.contentEditable=n,this.DOM.input.tabIndex=n?0:-1},setDisabled:function(n){this.setReadonly(n,"disabled")},normalizeTags:function(n){var D=this,A=this.settings,C=A.whitelist,k=A.delimiters,L=A.mode,P=A.tagTextProp,j=[],K=!!C&&J(C[0],Object),Y=Array.isArray(n),Z=Y&&n[0].value,h=function(n){return(n+"").split(k).reduce((function(n,A){var C,k=D.trim(A);return k&&n.push((X(C={},P,k),X(C,"value",k),C)),n}),[])};if("number"==typeof n&&(n=n.toString()),"string"==typeof n){if(!n.trim())return[];n=h(n)}else Y&&(n=n.reduce((function(n,A){if(c(A)){var C=u({},A);P in C||(P="value"),C[P]=D.trim(C[P]),(C[P]||0===C[P])&&n.push(C)}else if(null!=A&&""!==A&&void 0!==A){var k;(k=n).push.apply(k,$(h(A)))}return n}),[]));return K&&!Z&&(n.forEach((function(n){var A=j.map((function(n){return n.value})),C=D.dropdown.filterListItems.call(D,n[P],{exact:!0});D.settings.duplicates||(C=C.filter((function(n){return!A.includes(n.value)})));var k=C.length>1?D.getWhitelistItem(n[P],P,C):C[0];k&&J(k,Object)?j.push(k):"mix"!=L&&(null==n.value&&(n.value=n[P]),j.push(n))})),j.length&&(n=j)),n},parseMixTags:function(n){var D=this,A=this.settings,C=A.mixTagsInterpolator,k=A.duplicates,L=A.transformTag,P=A.enforceWhitelist,j=A.maxTags,K=A.tagTextProp,Y=[];n=n.split(C[0]).map((function(n,A){var Z,tt,et,it=n.split(C[1]),nt=it[0],st=Y.length==j;try{if(nt==+nt)throw Error;tt=JSON.parse(nt)}catch(n){tt=D.normalizeTags(nt)[0]||{value:nt}}if(L.call(D,tt),st||!(it.length>1)||P&&!D.isTagWhitelisted(tt.value)||!k&&D.isTagDuplicate(tt.value)){if(n)return A?C[0]+n:n}else tt[Z=tt[K]?K:"value"]=D.trim(tt[Z]),et=D.createTagElem(tt),Y.push(tt),et.classList.add(D.settings.classNames.tagNoAnimation),it[0]=et.outerHTML,D.value.push(tt);return it.join("")})).join(""),this.DOM.input.innerHTML=n,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize();var Z=this.getTagElms();return Z.forEach((function(n,D){return y(n,Y[D])})),this.update({withoutChangeEvent:!0}),O(Z,this.state.hasFocus),n},replaceTextWithNode:function(n,D){if(this.state.tag||D){D=D||this.state.tag.prefix+this.state.tag.value;var A,C,k=this.state.selection||window.getSelection(),L=k.anchorNode,P=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return L.splitText(k.anchorOffset-P),-1==(A=L.nodeValue.lastIndexOf(D))||(C=L.splitText(A),n&&L.parentNode.replaceChild(n,C)),!0}},prepareNewTagNode:function(n,D){D=D||{};var A=this.settings,C=[],k={},L=Object.assign({},n,{value:n.value+""});if(n=Object.assign({},L),A.transformTag.call(this,n),n.__isValid=this.hasMaxTags()||this.validateTag(n),!0!==n.__isValid){if(D.skipInvalid)return;if(u(k,this.getInvalidTagAttrs(n,n.__isValid),{__preInvalidData:L}),n.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(n.value)),!A.createInvalidTags)return void C.push(n.value)}return"readonly"in n&&(n.readonly?k["aria-readonly"]=!0:delete n.readonly),{tagElm:this.createTagElem(n,k),tagData:n,aggregatedInvalidInput:C}},postProcessNewTagNode:function(n,D){var A=this,C=this.settings,k=D.__isValid;k&&!0===k?this.value.push(D):(this.trigger("invalid",{data:D,index:this.value.length,tag:n,message:k}),C.keepInvalidTags||setTimeout((function(){return A.removeTags(n,!0)}),1e3)),this.dropdown.position()},selectTag:function(n,D){var A=this;if(!this.settings.enforceWhitelist||this.isTagWhitelisted(D.value)){this.state.actions.selectOption&&setTimeout((function(){return A.setRangeAtStartEnd(!1,A.DOM.input)}));var C=this.getLastTag();return C?this.replaceTag(C,D):this.appendTag(n),this.value[0]=D,this.update(),this.trigger("add",{tag:n,data:D}),[n]}},addEmptyTag:function(n){var D=u({value:""},n||{}),A=this.createTagElem(D);y(A,D),this.appendTag(A),this.editTag(A,{skipValidation:!0}),this.toggleFocusClass(!0)},addTags:function(n,D,A){var C=this,k=[],L=this.settings,P=[],j=document.createDocumentFragment(),K=[];if(!n||0==n.length)return k;switch(n=this.normalizeTags(n),L.mode){case"mix":return this.addMixTags(n);case"select":D=!1,this.removeAllTags()}return this.DOM.input.removeAttribute("style"),n.forEach((function(n){var D=C.prepareNewTagNode(n,{skipInvalid:A||L.skipInvalid});if(D){var Y=D.tagElm;if(n=D.tagData,P=D.aggregatedInvalidInput,k.push(Y),"select"==L.mode)return C.selectTag(Y,n);j.appendChild(Y),C.postProcessNewTagNode(Y,n),K.push({tagElm:Y,tagData:n})}})),this.appendTag(j),K.forEach((function(n){var D=n.tagElm,A=n.tagData;return C.trigger("add",{tag:D,index:C.getTagIdx(A),data:A})})),this.update(),n.length&&D&&(this.input.set.call(this,L.createInvalidTags?"":P.join(L._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),this.dropdown.refilter(),k},addMixTags:function(n){var D=this;if((n=this.normalizeTags(n))[0].prefix||this.state.tag)return this.prefixedTextToTag(n[0]);var A=document.createDocumentFragment();return n.forEach((function(n){var C=D.prepareNewTagNode(n);A.appendChild(C.tagElm),D.insertAfterTag(C.tagElm),D.postProcessNewTagNode(C.tagElm,C.tagData)})),this.appendMixTags(A),A.children},appendMixTags:function(n){var D=!!this.state.selection;D?this.injectAtCaret(n):(this.DOM.input.focus(),(D=this.setStateSelection()).range.setStart(this.DOM.input,D.range.endOffset),D.range.setEnd(this.DOM.input,D.range.endOffset),this.DOM.input.appendChild(n),this.updateValueByDOMTags(),this.update())},prefixedTextToTag:function(n){var D,A,C,k=this,L=this.settings,P=null===(D=this.state.tag)||void 0===D?void 0:D.delimiters;if(n.prefix=n.prefix||this.state.tag?this.state.tag.prefix:(L.pattern.source||L.pattern)[0],C=this.prepareNewTagNode(n),A=C.tagElm,this.replaceTextWithNode(A)||this.DOM.input.appendChild(A),setTimeout((function(){return A.classList.add(k.settings.classNames.tagNoAnimation)}),300),this.update(),!P){var j=this.insertAfterTag(A)||A;setTimeout(T,0,j)}return this.state.tag=null,this.postProcessNewTagNode(A,C.tagData),A},appendTag:function(n){var D=this.DOM,A=D.input;D.scope.insertBefore(n,A)},createTagElem:function(n,D){n.__tagId=f();var A,C=u({},n,G({value:d(n.value+"")},D));return function(n){for(var D,A=document.createNodeIterator(n,NodeFilter.SHOW_TEXT,null,!1);D=A.nextNode();)D.textContent.trim()||D.parentNode.removeChild(D)}(A=this.parseTemplate("tag",[C,this])),y(A,n),A},reCheckInvalidTags:function(){var n=this,D=this.settings;this.getTagElms(D.classNames.tagNotAllowed).forEach((function(A,C){var k=y(A),L=n.hasMaxTags(),P=n.validateTag(k),j=!0===P&&!L;if("select"==D.mode&&n.toggleScopeValidation(P),j)return k=k.__preInvalidData?k.__preInvalidData:{value:k.value},n.replaceTag(A,k);A.title=L||P}))},removeTags:function(n,D,A){var C,k=this,L=this.settings;if(n=n&&J(n,HTMLElement)?[n]:J(n,Array)?n:n?[n]:[this.getLastTag()].filter((function(n){return n})),C=n.reduce((function(n,D){D&&"string"==typeof D&&(D=k.getTagElmByValue(D));var A=y(D);return D&&A&&!A.readonly&&n.push({node:D,idx:k.getTagIdx(A),data:y(D,{__removed:!0})}),n}),[]),A="number"==typeof A?A:this.CSSVars.tagHideTransition,"select"==L.mode&&(A=0,this.input.set.call(this)),1==C.length&&"select"!=L.mode&&C[0].node.classList.contains(L.classNames.tagNotAllowed)&&(D=!0),C.length)return L.hooks.beforeRemoveTag(C,{tagify:this}).then((function(){var t=function(n){n.node.parentNode&&(n.node.parentNode.removeChild(n.node),D?L.keepInvalidTags&&this.trigger("remove",{tag:n.node,index:n.idx}):(this.trigger("remove",{tag:n.node,index:n.idx,data:n.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),L.keepInvalidTags&&this.reCheckInvalidTags()))};A&&A>10&&1==C.length?function(n){n.node.style.width=parseFloat(window.getComputedStyle(n.node).width)+"px",document.body.clientTop,n.node.classList.add(L.classNames.tagHide),setTimeout(t.bind(this),A,n)}.call(k,C[0]):C.forEach(t.bind(k)),D||(k.removeTagsFromValue(C.map((function(n){return n.node}))),k.update(),"select"==L.mode&&L.userInput&&k.setContentEditable(!0))})).catch((function(n){}))},removeTagsFromDOM:function(){this.getTagElms().forEach((function(n){return n.remove()}))},removeTagsFromValue:function(n){var D=this;(n=Array.isArray(n)?n:[n]).forEach((function(n){var A=y(n),C=D.getTagIdx(A);C>-1&&D.value.splice(C,1)}))},removeAllTags:function(n){var D=this;n=n||{},this.value=[],"mix"==this.settings.mode?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout((function(){D.DOM.input.focus()})),"select"==this.settings.mode&&(this.input.set.call(this),this.settings.userInput&&this.setContentEditable(!0)),this.update(n)},postUpdate:function(){this.state.blockChangeEvent=!1;var n,D,A=this.settings,C=A.classNames,k="mix"==A.mode?A.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;(this.toggleClass(C.hasMaxTags,this.value.length>=A.maxTags),this.toggleClass(C.hasNoTags,!this.value.length),this.toggleClass(C.empty,!k),"select"==A.mode)&&this.toggleScopeValidation(null===(D=this.value)||void 0===D||null===(n=D[0])||void 0===n?void 0:n.__isValid)},setOriginalInputValue:function(n){var D=this.DOM.originalInput;this.settings.mixMode.integrated||(D.value=n,D.tagifyValue=D.value,this.setPersistedData(n,"value"))},update:function(n){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout(function(){var D=this.getInputValue();this.setOriginalInputValue(D),this.settings.onChangeAfterBlur&&(n||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent();this.postUpdate()}.bind(this),100),this.events.bindOriginaInputListener.call(this,100)},getInputValue:function(){var n=this.getCleanValue();return"mix"==this.settings.mode?this.getMixedTagsAsString(n):n.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(n):JSON.stringify(n):""},getCleanValue:function(n){return a(n||this.value,this.dataProps)},getMixedTagsAsString:function(){var n="",D=this,A=this.settings,C=A.originalInputValueFormat||JSON.stringify,k=A.mixTagsInterpolator;return function i(A){A.childNodes.forEach((function(A){if(1==A.nodeType){var L=y(A);if("BR"==A.tagName&&(n+="\r\n"),L&&m.call(D,A)){if(L.__removed)return;n+=k[0]+C(o(L,D.dataProps))+k[1]}else A.getAttribute("style")||["B","I","U"].includes(A.tagName)?n+=A.textContent:"DIV"!=A.tagName&&"P"!=A.tagName||(n+="\r\n",i(A))}else n+=A.textContent}))}(this.DOM.input),n}},Q.prototype.removeTag=Q.prototype.removeTags;export{Q as default};

